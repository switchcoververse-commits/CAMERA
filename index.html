<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">

<style>
html,body{
margin:0;
padding:0;
background:#000;
font-family:-apple-system,sans-serif;
height:100%;
overflow:hidden;
}

.scanner-wrapper{
position:relative;
width:100%;
height:100dvh;
display:flex;
flex-direction:column;
}

.header{
text-align:center;
padding:10px;
color:#00d4ff;
z-index:5;
}

.camera-container{
position:relative;
flex:1;
display:flex;
align-items:center;
justify-content:center;
overflow:hidden;
}

video{
width:100%;
height:100%;
object-fit:cover;
}

.scanner-frame{
position:absolute;
width:80%;
aspect-ratio:4/3;
border:4px solid rgba(255,0,0,0.7);
border-radius:20px;
top:50%;
left:50%;
transform:translate(-50%,-50%);
transition:.25s ease;
pointer-events:none;
}

.controls{
position:fixed;
bottom:calc(15px + env(safe-area-inset-bottom));
left:0;
width:100%;
display:flex;
justify-content:center;
gap:20px;
z-index:20;
}

.shutter-btn{
width:75px;
height:75px;
border-radius:50%;
background:white;
border:5px solid #333;
}

.btn-finish{
display:none;
padding:12px 25px;
background:#00ff00;
border:none;
border-radius:40px;
font-weight:700;
}

.thumbnail-bar{
position:fixed;
bottom:calc(110px + env(safe-area-inset-bottom));
left:0;
width:100%;
display:flex;
overflow-x:auto;
gap:10px;
padding:8px;
background:rgba(0,0,0,.85);
z-index:15;
}

.thumb-wrapper{
position:relative;
}

.thumb-wrapper img{
height:70px;
border-radius:8px;
}

.delete-btn{
position:absolute;
top:-5px;
right:-5px;
background:red;
color:#fff;
border:none;
border-radius:50%;
width:20px;
height:20px;
font-size:12px;
}
</style>
</head>

<body>

<div class="scanner-wrapper">

<div class="header">SCANNER READY</div>

<div class="camera-container">
<video id="video" autoplay playsinline muted></video>
<div class="scanner-frame" id="frame"></div>
</div>

<div class="thumbnail-bar" id="thumbs"></div>

<div class="controls">
<div class="shutter-btn" id="capture"></div>
<button id="finish" class="btn-finish">FINISH ORDER</button>
</div>

</div>

<script>
const video=document.getElementById("video");
const frame=document.getElementById("frame");
const captureBtn=document.getElementById("capture");
const finishBtn=document.getElementById("finish");
const thumbs=document.getElementById("thumbs");

let photos=[];
let stableCounter=0;
let isLevelStable=false;

navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}})
.then(stream=>{video.srcObject=stream;});

window.addEventListener("deviceorientation",e=>{
if(e.beta===null||e.gamma===null) return;

const beta=Math.abs(e.beta-90);
const gamma=Math.abs(e.gamma);

if(beta<6 && gamma<6){
stableCounter++;
if(stableCounter>8){
isLevelStable=true;
frame.style.borderColor="#00ff00";
frame.style.borderWidth="6px";
}
}else{
stableCounter=0;
isLevelStable=false;
frame.style.borderColor="rgba(255,0,0,0.7)";
frame.style.borderWidth="4px";
}
});

captureBtn.addEventListener("click",e=>{
e.preventDefault();
if(!isLevelStable) return;

const canvas=document.createElement("canvas");
canvas.width=video.videoWidth;
canvas.height=video.videoHeight;
canvas.getContext("2d").drawImage(video,0,0);

const imgData=canvas.toDataURL("image/jpeg",0.7);
photos.push(imgData);

const wrapper=document.createElement("div");
wrapper.className="thumb-wrapper";

const img=document.createElement("img");
img.src=imgData;

const del=document.createElement("button");
del.className="delete-btn";
del.innerText="Ã—";

del.onclick=()=>{
const index=photos.indexOf(imgData);
if(index>-1) photos.splice(index,1);
wrapper.remove();
if(photos.length===0) finishBtn.style.display="none";
};

wrapper.appendChild(img);
wrapper.appendChild(del);
thumbs.appendChild(wrapper);

finishBtn.style.display="inline-block";
});

finishBtn.onclick=()=>{
location.reload();
};
</script>

</body>
</html>
