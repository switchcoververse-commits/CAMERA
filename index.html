<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Scanner Stable V1</title>

<style>
html,body{
margin:0;
padding:0;
background:#000;
font-family:-apple-system,BlinkMacSystemFont,sans-serif;
overflow:hidden;
}

#overlay{
position:fixed;
top:0;
left:0;
width:100%;
height:100%;
background:#000;
display:flex;
flex-direction:column;
justify-content:center;
align-items:center;
z-index:9999;
}

#overlay button{
padding:20px 50px;
font-size:22px;
font-weight:900;
border-radius:50px;
border:none;
background:#00d4ff;
color:#000;
}

#video{
position:fixed;
top:0;
left:0;
width:100%;
height:100%;
object-fit:cover;
display:none;
}

#frame{
position:fixed;
top:50%;
left:50%;
transform:translate(-50%,-50%);
width:80%;
height:60%;
border:5px solid red;
border-radius:25px;
pointer-events:none;
display:none;
transition:0.3s;
}

#controls{
position:fixed;
bottom:30px;
width:100%;
display:flex;
justify-content:center;
gap:20px;
display:none;
}

#capture{
width:80px;
height:80px;
border-radius:50%;
background:white;
border:6px solid #333;
}

#finish{
padding:12px 30px;
background:#00ff00;
border:none;
border-radius:40px;
font-weight:900;
}

#loading{
position:fixed;
top:0;
left:0;
width:100%;
height:100%;
background:black;
display:none;
justify-content:center;
align-items:center;
z-index:10000;
color:#00ff00;
font-weight:900;
font-size:20px;
}
</style>
</head>

<body>

<div id="overlay">
<h2 style="color:#00d4ff;">Align device and press Start</h2>
<button id="startBtn">START SCANNER</button>
</div>

<video id="video" playsinline autoplay muted></video>
<div id="frame"></div>

<div id="controls">
<div id="capture"></div>
<button id="finish">FINISH</button>
</div>

<div id="loading">SENDING TO DRIVE...</div>

<script>
window.addEventListener("load",function(){

const video=document.getElementById("video");
const frame=document.getElementById("frame");
const startBtn=document.getElementById("startBtn");
const overlay=document.getElementById("overlay");
const controls=document.getElementById("controls");
const capture=document.getElementById("capture");
const finish=document.getElementById("finish");
const loading=document.getElementById("loading");

let stream=null;
let photos=[];
let levelOK=false;
const MAX_PHOTOS=30;
const WEBAPP_URL="YOUR_WEBAPP_URL_HERE";

function initOrientation(){
if(window.DeviceOrientationEvent){
window.addEventListener("deviceorientation",function(e){

if(e.beta===null || e.gamma===null){return;}

let beta=Math.abs(e.beta);
let gamma=Math.abs(e.gamma);

let wall=(beta>80 && beta<100 && gamma<10);
let flat=(beta<10 && gamma<10);

if(wall || flat){
frame.style.borderColor="#00ff00";
levelOK=true;
}else{
frame.style.borderColor="red";
levelOK=false;
}

});
}
}

async function startCamera(){
stream=await navigator.mediaDevices.getUserMedia({
video:{facingMode:"environment"},
audio:false
});
video.srcObject=stream;
video.style.display="block";
frame.style.display="block";
controls.style.display="flex";
overlay.style.display="none";
initOrientation();
}

startBtn.addEventListener("click",function(){
startCamera();
});

capture.addEventListener("click",function(){

if(!levelOK){return;}
if(photos.length>=MAX_PHOTOS){return;}

let canvas=document.createElement("canvas");
canvas.width=video.videoWidth;
canvas.height=video.videoHeight;
canvas.getContext("2d").drawImage(video,0,0);
photos.push(canvas.toDataURL("image/jpeg",0.6));

});

finish.addEventListener("click",async function(){

if(photos.length===0){return;}

loading.style.display="flex";

await fetch(WEBAPP_URL,{
method:"POST",
mode:"no-cors",
body:JSON.stringify({photos:photos})
});

loading.style.display="none";
alert("DONE");

});

});
</script>

</body>
</html>
